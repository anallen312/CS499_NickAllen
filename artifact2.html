<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Artifact 2 - Algorithms & Data Structures</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <h1>Artifact 2: Algorithms & Data Structures</h1>
        <nav>
            <a href="index.html">Home</a>
            <a href="code-review.html">Code Review</a>
            <a href="artifacts.html">Artifacts</a>
            <a href="self-assessment.html">Self-Assessment</a>
        </nav>
    </header>
    <section>
        <h2>Overview</h2>
        <p>
            This enhancement improves the data processing and algorithmic functionality within the GravityGauge project. 
            The key improvement was implementing a moving average algorithm to track weight trends over time. Additionally, 
            the user interface was updated to present this data in a more structured format.
        </p>

        <h2>Implemented Moving Average Algorithm</h2>
        <p>Below is the updated algorithm implementation:</p>
        <img src="artifact2.png" alt="Updated Moving Average Algorithm" style="width:50%; max-width:600px; display:block; margin:auto; border:1px solid #ccc; padding: 5px;">
        <p>
            This function calculates the weekly weight trend, allowing users to see if they are gaining or losing weight over time. 
            A testing mode was also added to allow calculations to be based on either the last seven real-world days or the 
            last seven weight entries for easier debugging.
        </p>

        <h2>Testing Mode Implementation</h2>
        <p>
            A new testing mode was added, allowing developers to simulate a seven-day trend using the last seven entries instead of real-world time.
        </p>
        <img src="testingmode.png" alt="Testing Mode Implementation" style="width:50%; max-width:600px; display:block; margin:auto; border:1px solid #ccc; padding: 5px;">

        <h2>Changes Implemented</h2>
        <p>Before this enhancement, the application lacked a way to analyze long-term weight trends. The following changes were made:</p>
        <ul>
            <li>Added a moving average algorithm to DatabaseManager.java.</li>
            <li>Updated activity_weight_data.xml to display the computed weight trend.</li>
            <li>Modified getAllWeightEntries() to sort entries with the newest first.</li>
            <li>Enabled a vertical scrollbar in RecyclerView for better navigation.</li>
            <li>Verified SQLite database functionality using Android Studio's Database Inspector.</li>
        </ul>

        <h2>Code Example: Before vs. After</h2>

        <h3>Before Enhancement (No Moving Average Calculation)</h3>
        <pre>
        public List<WeightEntry> getAllWeightEntries() {
            List<WeightEntry> entries = new ArrayList<>();
            SQLiteDatabase db = this.getReadableDatabase();
            Cursor cursor = db.rawQuery("SELECT * FROM weight_entries", null);

            if (cursor.moveToFirst()) {
                do {
                    entries.add(new WeightEntry(cursor.getInt(0), cursor.getInt(1)));
                } while (cursor.moveToNext());
            }
            cursor.close();
            db.close();
            return entries;
        }
        </pre>

        <h3>After Enhancement (Moving Average Implemented)</h3>
        <pre>
        private List<WeightEntry> weightCache = null;

        public List<WeightEntry> getWeightEntries() {
            if (weightCache != null) {
                return weightCache;
            }

            weightCache = new ArrayList<>();
            try (SQLiteDatabase db = this.getReadableDatabase();
                 Cursor cursor = db.rawQuery("SELECT * FROM weight_entries", null)) {
                while (cursor.moveToNext()) {
                    weightCache.add(new WeightEntry(cursor.getInt(0), cursor.getInt(1)));
                }
            }
            return weightCache;
        }

        public double getMovingAverage(boolean testMode) {
            List<Double> weights = new ArrayList<>();
            SQLiteDatabase db = this.getReadableDatabase();
            String query = testMode 
                ? "SELECT weight FROM weight_entries ORDER BY id DESC LIMIT 7"
                : "SELECT weight FROM weight_entries WHERE date >= date('now', '-7 days')";
            Cursor cursor = db.rawQuery(query, null);

            while (cursor.moveToNext()) {
                weights.add(cursor.getDouble(0));
            }
            cursor.close();

            if (weights.isEmpty()) return 0.0;
            double sum = 0.0;
            for (double weight : weights) sum += weight;
            return sum / weights.size();
        }
        </pre>

        <h2>Enhancing UI: Displaying Weekly Trends</h2>
        <p>
            A new TextView was added to activity_weight_data.xml to display the weekly average weight change.
            The moving average function updates dynamically when a new weight entry is added.
        </p>
        <img src="activityweightdata.png" alt="Updated XML Layout for Weight Data Screen" style="width:50%; max-width:600px; display:block; margin:auto; border:1px solid #ccc; padding: 5px;">

        <h3>Updated UI Code in WeightDataActivity.java</h3>
        <pre>
        private void updateWeightTrend() {
            double avgChange = dbManager.getMovingAverage(false);
            avgWeightChangeTextView.setText("Weekly Average Change: " + avgChange + " lbs");
        }
        </pre>

        <h2>Impact of the Enhancement</h2>
        <p>
            These improvements resulted in:
        </p>
        <ul>
            <li>More meaningful weight tracking by analyzing long-term trends.</li>
            <li>Better user experience with clear trend visualization.</li>
            <li>Improved database efficiency by using optimized queries.</li>
        </ul>

        <h2>Conclusion</h2>
        <p>
            By adding a moving average algorithm, testing mode, and improving UI responsiveness, the GravityGauge app is now more effective 
            at tracking user weight trends. These enhancements improved both algorithmic efficiency and user experience.
        </p>
    </section>
</body>
</html>
